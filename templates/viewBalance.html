{% extends "base.html" %}
{% block title %}Login System{% endblock %}

{% block content %}

{% if message  %}
    <div class="alert alert-secondary" role="alert">
        <p>{{ message }}</p>
    </div>
{% endif %}

<form action="/menu" >

    <label for="MoneyCollected" display: inline-block;>Money Collected</label>
    <input name="moneyCollected" class="form-control" id="MoneyCollected"  display: inline-block; placeholder={{ MoneyCollected }} disabled>
    <label for="InputUsername">Name</label>
    <input name="email" class="form-control" id="InputUsername"  placeholder={{ Username }} disabled>
    <label for="InputBalance">Balance</label>
    <input  name="email" class="form-control" id="InputBalance"  placeholder= {{ Balance }} disabled>
    <input class = "radioBtn" type="radio" id="amount20" name="amount" value="20">
    <label for="amount20">20</label>
    <input class = "radioBtn" type="radio" id="amount50" name="amount" value="50">
    <label for="amount50">50</label><br>
    <input class = "radioBtn" type="radio" id="amount100" name="amount" value="100">
    <label for="amount100">100</label>
    <input class = "radioBtn" type="radio" id="other" name="amount" value= "Other">
    <label for="other">other</label>
    <br>

    <input name="email" class="form-control" type="number" id="amount"  placeholder=  "Enter Amount" disabled = "disabled">
    <button type = "button" class = 'btn btn-primary' onclick = "credit( {{ Balance }}, {{ code }} )" > Debit </button>
    <script type="text/javascript">
    $(".radioBtn").click(function() {
    $("#amount").attr("disabled", true);
        if ($("input[name=amount]:checked").val() == "Other") {
            $("#amount").attr("disabled", false);
        }
    });
</script>
    <a class = "button btn btn-primary" href = "/scanQRdebit" >Scan QR</a>
    <a class = "button btn btn-primary" href = "/" >Menu</a>
    <button type = "button" class = 'btn btn-primary' onclick = "last10Transaction( {{ code }} )" > Last 10 Transaction </button>
</form>
    <script>
        function last10Transaction(code){
	window.location = '/lastTransactions?code='+code;	
          
	}


        function credit(balance, code ) {
        var amount_list = document.getElementsByName('amount');
        amount =0;
        for(i = 0; i<amount_list.length; i++) {
            if(amount_list[i].checked) {
                if(amount_list[i].value == 'Other'){
                    amount = parseInt(document.getElementById('amount').value);
                    break;
                } else {
                    amount = parseInt(amount_list[i].value);
                    break;
                }
            }
        }
        if( amount <= 0) {
        alert("Enter valid Amount");
        return;
        }

        var xhr = new XMLHttpRequest();
        xhr.open("POST", "/debit", true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.send(JSON.stringify({
            amount: amount,
            code: code,
            balance: balance
        }));
        xhr.onload = function() {
          console.log("HELLO")
          console.log(this.responseText);
          var data = JSON.parse(this.responseText);
          console.log(data);
          if(data['status'] == 'success')
            alert("Debit Successful of Rs." + data['amount']);
          else {
            if(data['message']){
                alert(data['message']);
            }
          }
	console.log([data['total_amount_debited']])
          if( data['balance'] )
    	        document.getElementById('InputBalance').value = data['balance'];
    		document.getElementById('MoneyCollected').value = data['total_amount_debited'];
	}
}
    </script>
{% endblock %}
